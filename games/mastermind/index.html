<!doctype html>
<html lang="hi">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mastermind — Ravindra Games Hub</title>
    <link rel="stylesheet" href="../../style.css">
</head>

<body>
    <div class="container">
        <h2>Mastermind (4 slots, 6 colors)</h2>
        <div id="gameArea"></div>
        <div style="margin-top:12px"><button id="restart" class="chip">Restart</button></div>
        <p id="secret">Code is</p>
        <p id="choice">Guess Code is</p>
        <section class="leaderboard-section">
            <div id="leaderboard"></div>
          </section>
    </div>
    <script type="module">
        // import { renderLeaderboard } from "../../leaderboard/leaderboard.js";
    
        // ✅ Leaderboard को DOM लोड के बाद रेंडर करें
        window.addEventListener("DOMContentLoaded", () => {
          renderLeaderboard("mastermind", "#leaderboard");
        });
      </script>

    <script>
        // Simple Mastermind: randomly generate code of 4 colors (0..5). Player guesses via prompts.
        let secret = Array.from({ length: 4 }, () => Math.floor(Math.random() * 6));
        console.log("secret", secret);
        document.getElementById("secret").textContent = secret;
        let attempts = 0;
        async function makeGuess() {
            const guessStr = prompt('Enter 4 digits (0-5) e.g. 0123'); if (!guessStr) return;
            const guess = guessStr.split('').map(Number);
            attempts++;
            let exact = 0, colorOnly = 0;
            const sCopy = [...secret];
            for (let i = 0; i < 4; i++) if (guess[i] === sCopy[i]) { exact++; sCopy[i] = null; }
            for (let i = 0; i < 4; i++) {
                if (guess[i] !== secret[i]) {
                    const idx = sCopy.indexOf(guess[i]); if (idx !== -1) { colorOnly++; sCopy[idx] = null; }
                }
            }
            const msg = `Attempt ${attempts}: exact=${exact}, color=${colorOnly}`;
            alert(msg);
            document.getElementById("choice").textContent = msg;
            if (exact === 4) { const score = Math.max(0, 100 - attempts * 10); console.log("window.submitScore", window.submitScore)
            window.submitScore && window.submitScore('mastermind', finalScore, 'player'); alert('Game over — score: ' + finalScore); }
        }
        document.getElementById('gameArea').innerHTML = '<button id="guessBtn" class="btn">Make Guess</button>';
        document.getElementById('guessBtn').addEventListener('click', makeGuess);
        document.getElementById('restart').addEventListener('click', () => { secret = Array.from({ length: 4 }, () => Math.floor(Math.random() * 6)); attempts = 0; alert('New code generated'); });
    </script>

    <!-- ✅ Global function (window.submitScore) -->
<script>
    window.submitScore = async function (game_id, score) {
      const player_name = localStorage.getItem("player_name") || "Guest";
      const email = localStorage.getItem("email") || "";

      try {
        const res = await fetch("https://bkhoexvgorxzgdujofar.supabase.co/functions/v1/submit-score", {
          method: "POST",
          headers: {
            "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJraG9leHZnb3J4emdkdWpvZmFyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MTE3NDgsImV4cCI6MjA3NjA4Nzc0OH0.DG1jB5GDBJAtfOsJF0KjO8luVVTLTgx6MlZIvj_v7IQ",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ player_name, email, game_id, score })
        });

        const data = await res.json();
        console.log("✅ Score saved:", data);
        alert("✅ " + data.message);
      } catch (err) {
        console.error("❌ Error saving score:", err);
        alert("❌ Error saving score. Check console.");
      }
    };
  </script>
</body>

</html>