<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastermind game by Player</title>
    <!-- /Mastermind/
    ‚îÇ
    ‚îî‚îÄ‚îÄ /project/
        ‚îú‚îÄ‚îÄ index.html
        ‚îú‚îÄ‚îÄ style.css
        ‚îú‚îÄ‚îÄ /js/
        ‚îÇ   ‚îú‚îÄ‚îÄ script.js
        ‚îÇ   ‚îú‚îÄ‚îÄ speak.js
        ‚îÇ   ‚îî‚îÄ‚îÄ sound.js
        ‚îî‚îÄ‚îÄ /assets/
            ‚îú‚îÄ‚îÄ /font/
            ‚îÇ   ‚îú‚îÄ‚îÄ Bangears-Regular.ttf
            ‚îÇ   ‚îú‚îÄ‚îÄ GajrajOne-Regular.ttf.ttf
            ‚îî‚îÄ‚îÄ /sound/
                ‚îú‚îÄ‚îÄ inhalation-and-exhalation.mp3
                ‚îú‚îÄ‚îÄ Clock-Ticking-one.mp3
                ‚îú‚îÄ‚îÄ fireworks.mp3
                ‚îú‚îÄ‚îÄ Looser.mp3
                ‚îú‚îÄ‚îÄ winner-trumpets.mp3
                ‚îî‚îÄ‚îÄ tap-sound.mp3      -->
    <!-- Mastermind
        with seperate liberary files
        with responsive layout
        with 2 downloaded font
        with dark/light theme 
        with speak in english
        with timer display
        with ledder board
        with 1 to 8 no slots choose (default 3)
            1 slot no coice
            8 slot very hard
        with 1 to 12 no slots choose (default 12)
            min colors equal to number of slots
            colors equal to slots easy
            12 colors harder
            12 colors and 8 slots hardest 
        colors with number for color blind persion -->
        <!-- <link rel="stylesheet" href="style.css"> -->
    <style>
        :root {
            --bg: #f0f0f0;
            --text: #222;
            --cell-border: #333;
            --box-shadow: rgba(0, 0, 0, 0.2);
            --card:#fff;
            --muted:#d0d7de;
            --accent:#4f46e5;
            --good:#16a34a;
            --bad:#dc2626;
            --shadow: 0 6px 20px rgba(0,0,0,.08);
        }

        body.dark {
            --bg: #454545;
            --text: #eee;
            --cell-border: #d9d8d8;
            --box-shadow: rgba(255, 255, 255, 0.3);
            --card:#0b1223; 
            --muted:#273248; 
            --accent:#818cf8;
            --shadow: 0 6px 20px rgba(0,0,0,.35);
        }

        @font-face {
            font-family: 'HindiFontGajraj';
            src: url('assets/font/GajrajOne-Regular.ttf') format('truetype');
        }

        @font-face {
            font-family: 'EnglishFontBangers';
            src: url('assets/font/Bangers-Regular.ttf') format('truetype');
        }

        @font-face {
            font-family: 'Digital';
            src: url('assets/font/digital-italic.ttf') format('truetype');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 1.6vw;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: Arial, sans-serif;
            box-sizing: border-box;
            background: var(--bg);
            color: var(--text);
            transition: background 0.3s, color 0.3s;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* Layout Responsive */
        #container {
            display: flex;
            flex-direction: row;
            padding: 0.1vw;
        }

        .section {
            box-sizing: border-box;
            padding: 1vw;
            overflow: hidden;
        }

        #left {
            background: var(--bg-color);
            padding: 0.1vw;
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            max-width: 30vw;
        }

        h1 {
            text-align: center;
            font-size: 3vw;
            font-family: 'EnglishFontBangers', Arial, Helvetica, sans-serif;
            color: var(--text-color);
            letter-spacing: .8vw;
            text-shadow: 0 1px 0 #030303,
                0 2px 0 #c9c9c9,
                0 3px 0 #bbb,
                0 4px 0 #b9b9b9,
                0 5px 0 #aaa,
                0 6px 1px var(--box-shadow),
                0 0 5px var(--box-shadow),
                0 1px 3px var(--box-shadow),
                0 3px 5px var(--box-shadow),
                0 5px 10px var(--box-shadow),
                0 10px 10px var(--box-shadow),
                0 20px 20px var(--box-shadow);
            margin-bottom: 0.3vw;
        }

        h3 {
            text-align: center;
            margin: 0;
            margin: 0.4vw;
            padding: 0.5vw;
            background: var(--bg-color);
            color: var(--text-color);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.2vw;
            padding: 0.2vw;
            justify-content: center;
            margin-bottom: 0.2vw;
            margin-top: 0.3vw;
            width: 100%;
            box-shadow: 0 0.5vw 2.5vw 0 var(--box-shadow);
        }

        select,
        button,
        label,
        input [type="number"] {
            padding: 0.2vw 0.3vw;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 0.5vw 2.5vw 0 var(--box-shadow);
            border: 0.1vw solid var(--cell-border);
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 1.6vw;
            border-radius: 0.5vw;
        }

        select:hover {
            background: var(--bg-hover);
        }

        input:hover {
            background: var(--bg-hover);
        }

        button:hover {
            background: var(--bg-hover);
        }

        .message {
            width: 100%;
            text-align: center;
            background: var(--bg-color);
            margin-top: 0.1vh;
            padding: 1vw;
            border: 0.3vw dashed var(--box-shadow);
            color: var(--text-color);
            font-weight: bold;
            font-size: 1.5vw;
            box-shadow: 0 0.5vw 2.5vw 0 var(--box-shadow);
        }

        #right {
            background: var(--bg-color);
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.1vw;
            justify-content: center;
        }

        .divtext {
            width: 6vw;
            background: var(--bg-color);
            color: var(--text-color);
            display: flex;
            align-items: center;
            padding: 0.1vw;
            margin: 0.1vw;
            justify-content: center;
        }

        .divslot {
            background: var(--bg-color);
            color: var(--text-color);
            border: 0.2vw solid var(--cell-border);
            display: flex;
            align-items: center;
            padding: 0.1vw;
            margin: 0.1vw;
            justify-content: center;
        }

        @keyframes color {
            0% {
                border-color: #ffffff;
            }

            50% {
                border-color: var(--bg-color);
            }

            100% {
                border-color: var(--cell-border);
            }
        }

        #game {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .board {
            display: flex;
            gap: 0.8vw;
            align-items: center;
            margin: 0.2vw 0;
            flex-wrap:wrap;
        }

        .row {
            display: flex;
            margin: 0.2vw;
            padding: 0vw;
            align-items: center;
            flex-wrap: wrap;
        }

        .slot,
        .color-option {
            width: 4vw;
            height: 4vw;
            border: 0.2vw solid #333;
            border-radius: 50%;
            margin: 0.4vw;
            cursor: pointer;
            box-sizing: border-box;
            box-shadow: 0 0.5vw 2.5vw 0 var(--box-shadow);
        }

        body.dark .slot,
        body.dark .color-option {
            border-color: #ccc;
        }

        .feedback {
            display: flex;
            flex-wrap: wrap;
            width: 7vw;
            margin-left: 0.5vw;
        }

        .feedback div {
            width: 1.2vw;
            height: 1.2vw;
            margin: 0.2vw;
            border-radius: 50%;
            border: 0.1vw solid #555;
        }

        .color-picker {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin: 1vw;
        }

        button {
            padding: 0.6vw 1.2vw;
            margin-top: 1vw;
            cursor: pointer;
        }

        .popup {
            position: absolute;
            display: none;
            flex-wrap: wrap;
            background: #fff;
            border: 0.1vw solid #aaa;
            border-radius: 0.8vw;
            padding: 0.5vw;
            z-index: 999;
            box-shadow: 0 0.2vw 1vw rgba(0, 0, 0, 0.2);
        }

        #visualGuesses {
            margin-top: 1.2vw;
            display:flex;
            flex-direction:column;
            /* gap:0.8vw; */
            max-height:36vw;
            overflow:auto;
            padding-right:0.6vw
        }

        .fb-submit {
            padding: 0.8vw 1vw;
            border-radius:0.8vw;
            background:var(--accent);
            color:white;
            border:none;
            margin: auto;
        }

        .log {
            margin-top: 1.2vw;
            background: var(--bg);
            color: var(--text);
            padding: 1vw;
            border-radius: 0.8vw;
            overflow: auto;
            font-family: monospace;
            font-size: 1.3vw
        }

        .timer {
            font-family: 'Digital', Arial, Helvetica, sans-serif;
            display: grid;
            align-items: center;
            font-size: 1.6vw;
            font-weight: bold;
            color: var(--text-color);
            /* font-variant-numeric: tabular-nums; */
        }

        /* Portrait (Top-Bottom layout) */
        @media (max-aspect-ratio: 1/1) {
            #container {
                flex-direction: column;
            }

            #left {
                width: 100%;
                max-width: 100%;
                flex: 0 0 auto;
            }

            #right {
                flex: 1;
                width: 100%;
            }
        }

        table,
        th,
        td {
            border: 0.1vw solid var(--cell-border);
            box-shadow: 0 0.5vw 2.5vw 0 var(--box-shadow);
            margin: auto;
            text-align: center;
            padding: 0.1vw;
        }

        #displayTime {
            font-family: 'Digital', Arial, Helvetica, sans-serif;
            text-align: center;
            width: auto;
            height: auto;
            font-size: 1.5vw;
            padding: 1vw 1vw;
            color: var(--text);
            border: none;
        }

        /* submenu display css */
        .menu {
            display: none;
            position: sticky;
            padding: 0vw 0vw;
            background-color: #f9f9f9;
            min-width: 21.3vw;
            box-shadow: 0 0.8vw 0.5vw 0 rgba(0, 0, 0, 0.2);
            z-index: 1;
        }

        .menuul {
            list-style-type: none;
            padding: 0.1vw 0.1vw;
            margin: 0;
        }

        .menuli {
            display: inline-flex;
            width: auto;
            height: auto;
            padding: 1vw 1vw;
            object-fit: "cover";
            background-size: 1.5vw;
            background-repeat: no-repeat;
            background-position: center center;
        }

        .menuli:hover {
            border: .2rem solid white;
        }

        #fireworksCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        #winText {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 6vw;
            color: gold;
            text-shadow: 0.2vw 0.2vw 1vw #fff;
            font-weight: bold;
            opacity: 0;
            z-index: 2;
            transition: opacity 0.5s ease, transform 0.5s ease;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div id="container">
        <!-- Left Panel -->
        <div id="left" class="section">
            <h1>üéØMastermind</h1>
            <div class="button-group">
                <div class="button-group" style="border: 0.1vw solid var(--cell-border);">
                    <label for="slotInput">No of Slots:
                        <input type="number" id="slotInput" min="1" max="12" value="3">
                    </label>
                    <label for="colorInput">No of Colors:
                        <input type="number" id="colorInput" min="1" max="20" value="4">

                    </label>
                    <label>Max Attempts:
                        <input type="number" id="maxAttempts" min="4" max="20" value="10">
                    </label>
                    <label id="allowedDuplicates">Allow Duplicate Colors
                        <input type="checkbox" id="buttonDuplicate" checked>
                    </label>
                    <button id="buttonStart">New Game</button>
                </div>
                <button id="undo-last">‚Ü©Ô∏è Undo</button>
                <button id="buttonEnd">End</button>
                <button id="dark">‚òÄÔ∏è Light</button>
                <button id="toggle-sound">üîá Music:Off"</button>
                <div id="timer-display" class="timer">‚è±Ô∏è 00:00:00</div>
                <button id="toggle-leaderboard">View Leaderboard</button>
                <div class="message" id="output">
                    Please Click on Circle to select your secreate colors and press Start
                </div>
                <div id="leaderboard"></div>
            </div>
        </div>
        <!-- Right Grid -->
        <div id="right">
            <div class="board" id="secretBoard"></div>
            <div id="game"> 
                <div id="colorPopup" class="popup"></div>
                <div id="visualGuesses"></div>
            </div>
            <div class="log" id="log"></div>
        </div>
    </div>

    <!-- Display winning text -->
    <div id="winText">üéâ You Won! üéâ</div>
    <!-- fire crackers canvas -->
    <canvas id="fireworksCanvas"></canvas>
    <!-- <script type="module" src="js/script.js"></script> -->

    <script>
        // import { startTimer } from './timer.js';
        // import { launchFireworks } from './edgeFireWorks.js';
        // import { playSound } from './sound.js';
        // import { textToSpeechEng } from './speak.js';
        // import { saveToLeaderboard, toggleLeaderboard, clearLeaderboard } from './leaderboard.js';

        // define variables
        let timer = false;
        let hours = 0;
        let minutes = 0;
        let seconds = 0;
        let hrdsec = 0;
        let slotCount = 4;
        let colorCount = 6;
        let maxAttempts = 10;
        let attemptsLeft = 0;
        let colors = [];
        let secretCode = [];
        let currentGuess = [];
        let guesses = [];
        let gameOver = false;
        let allowDuplicates = true;

        const colorList = ["#FF0000", "#8b0000", "#fa8072", "#00FF00",
            "#008000", "#006400", "#9acd32", "#008080", "#0000FF", "#000080",
            "#00bfff", "#FFFF00", "#ffd700", "#bdb76b", "#00FFFF", "#00ced1",
            "#7fffd4", "#FF00FF", "#ee82ee", "#9932cc", "#800080", "#9370db",
            "#800000", "#A52A2A", "#808000", "#FFC0CB", "#c71585", "#ff1493",
            "#ff69b4", "#FFA500", "#FF4500", "#ff7f50", "#000000", "#808080",
            "#C0C0C0", "#2f4f4f", "#696969"];

        document.getElementById('output').textContent = "Please Select slots/colors/Duplicates/attempts, then Press New Game to play";

        const visualEl = document.getElementById('visualGuesses');
        const output = document.getElementById('output');
        const toggleThemeBtn = document.getElementById("toggleTheme");
        const secretBoardEl = document.getElementById('secretBoard');
        const leaderboardEl = document.getElementById('leaderboard');
        const canvas = document.getElementById('fireworksCanvas');
        const ctx = canvas.getContext('2d');

        // set default Player Name or ask player name
        let player1 = "Human";
        // player1 = prompt("Enter Player Name (default Human?") || player1;

        document.getElementById("buttonDuplicate").onchange = (e) => {
            allowDuplicates = e.target.checked;
            if(allowDuplicates){
                textToSpeechEng(`Duplicate Colors`);
            } else if (slotCount > colorCount) {
                textToSpeechEng(`Duplicate Colors due less then slots`);
            } else {
                textToSpeechEng(`Unique Colors`);
            }
        };

        document.getElementById("buttonStart").onclick = startGame;
        document.getElementById("undo-last").onclick = undoLastMove;
        document.getElementById("buttonEnd").onclick = endGameManually;

        // chhose colors from array
        function generateColors(count) {
            const arr = [];
            for (let i = 0; i < count; i++) {
                arr.push(colorList[i]);
            }
            // console.log(arr)
            return arr;
        }

        // generate secrate code for find it
        function generateSecretCode() {
            secretCode = [];
            const used = new Set();
            while (secretCode.length < slotCount) {
                let colorIndex = Math.floor(Math.random() * colorCount);
                if (!allowDuplicates && used.has(colorIndex)) continue;
                secretCode.push(colorIndex);
                used.add(colorIndex);
            }
            renderSecret();
            // console.log("Secret Code:", secretCode); // For testing
        }
        // display secrate color in slot (select/change by click)
        function renderSecret() {
            secretBoardEl.innerHTML = '';
            for (let i = 0; i < slotCount; i++) {
                const s = document.createElement('div');
                s.className = 'slot';
                if (gameOver){
                    s.style.background = colors[secretCode[i]];
                    s.textContent = colors.indexOf(colors[secretCode[i]]); 
                    s.style.color = 'white'; 
                } else {
                    s.classList.add('empty');
                    s.textContent = '?'; 
                    s.style.color = 'black'; 
                }
                s.style.textShadow='0 0.1vw 0.2vw rgba(0,0,0,.6)'; 
                s.style.fontWeight = 'bold'; 
                s.style.display = 'grid'; 
                s.style.textAlign = 'center'; 
                s.style.alignItems = 'center'; 
                secretBoardEl.appendChild(s);
            };
        }

        // start game
        function startGame() {
            slotCount = parseInt(document.getElementById("slotInput").value);
            colorCount = parseInt(document.getElementById("colorInput").value);
            maxAttempts = parseInt(document.getElementById("maxAttempts").value);
            attemptsLeft = maxAttempts;
            colors = generateColors(colorCount);
            generateSecretCode();
            currentGuess = Array(slotCount).fill(null);
            guesses = [];
            gameOver = false;
            selectedIndex = null;
            if (!timer) {
                timer = true;
                updateTimer();
            }
            updateScoreboard();
            renderGame();
        }

        // update message
        function updateScoreboard(msg = "") {
            document.getElementById("output").textContent = `${msg} Attempts Left: ${attemptsLeft}`;
        }

        // display game slots
        function renderGame() {
            visualEl.innerHTML = "";

            guesses.forEach(entry => {
                const guessRow = document.createElement("div");
                guessRow.className = "row";

                entry.guess.forEach(colorIdx => {
                    const slot = document.createElement("div");
                    slot.className = "slot";
                    slot.style.background = colors[colorIdx];
                    slot.textContent = colorIdx; 
                    slot.style.color = '#fff'; 
                    slot.style.textShadow='0 0.1vw 0.2vw rgba(0,0,0,.6)'; 
                    slot.style.fontSize = '1.6vw'; 
                    slot.style.fontWeight = 'bold'; 
                    slot.style.display = 'grid'; 
                    slot.style.textAlign = 'center'; 
                    slot.style.alignItems = 'center'; 
                    guessRow.appendChild(slot);
 
                });

                const feedbackDiv = document.createElement("div");
                feedbackDiv.className = "feedback";
                for (let i = 0; i < entry.black; i++) {
                    const peg = document.createElement("div");
                    peg.style.background = "black";
                    feedbackDiv.appendChild(peg);
                }
                for (let i = 0; i < entry.white; i++) {
                    const peg = document.createElement("div");
                    peg.style.background = "white";
                    feedbackDiv.appendChild(peg);
                }

                guessRow.appendChild(feedbackDiv);
                visualEl.appendChild(guessRow);
            });

            if (!gameOver) {
                const guessRow = document.createElement("div");
                guessRow.className = "row";

                currentGuess.forEach((guess, idx) => {
                    const slot = document.createElement("div");
                    slot.className = "slot";
                    slot.style.background = guess !== null ? colors[guess] : "white";
                    if (guess !== null){
                        slot.style.background = colors[guess];
                        slot.textContent = colors.indexOf(colors[guess]); 
                        slot.style.color = '#fff'; 
                        slot.style.textShadow='0 0.1vw 0.2vw rgba(0,0,0,.6)'; 
                        slot.style.fontSize = '1.6vw'; 
                        slot.style.fontWeight = 'bold'; 
                        slot.style.display = 'grid'; 
                        slot.style.textAlign = 'center'; 
                        slot.style.alignItems = 'center'; 
                    } else {
                        slot.style.background = "white";
                    }
                    let pressTimer;
                    slot.onmousedown = (e) => {
                        e.preventDefault();
                        pressTimer = setTimeout(() => {
                            currentGuess[idx] = null;
                            renderGame();
                        }, 600);
                    };
                    slot.onmouseup = () => clearTimeout(pressTimer);
                    slot.ontouchstart = (e) => {
                        pressTimer = setTimeout(() => {
                            currentGuess[idx] = null;
                            renderGame();
                        }, 600);
                    };
                    slot.ontouchend = () => clearTimeout(pressTimer);
                    slot.onclick = (e) => showColorPopup(e, idx);
                    //

                    guessRow.appendChild(slot);
                });

                   const submitB = document.createElement('button');
                    submitB.className = 'fb-submit';
                    submitB.textContent = 'OK';
                    submitB.onclick = checkGuess;
                    guessRow.appendChild(submitB);

                visualEl.appendChild(guessRow);
            } else {
                const secretRow = document.createElement("div");
                secretRow.className = "row";
                secretCode.forEach(colorIdx => {
                    const slot = document.createElement("div");
                    slot.className = "slot";
                    slot.style.background = colors[colorIdx];

                    slot.textContent = colorIdx; 
                    slot.style.color = '#fff'; 
                    slot.style.textShadow='0 0.1vw 0.2vw rgba(0,0,0,.6)'; 
                    slot.style.fontSize = '1.6vw'; 
                    slot.style.fontWeight = 'bold'; 
                    slot.style.display = 'grid'; 
                    slot.style.textAlign = 'center'; 
                    slot.style.alignItems = 'center'; 

                    secretRow.appendChild(slot);
                });
                visualEl.appendChild(secretRow);
                renderSecret();
            }

            hidePopup(); // hide old popup on re-render
        }

        // display submenu
        function showColorPopup(event, slotIndex) {
            playSound('beep');
            const popup = document.getElementById("colorPopup");
            popup.innerHTML = "";
            popup.style.display = "flex";
            popup.style.left = `${event.pageX}px`;
            popup.style.top = `${event.pageY + 10}px`;

            colors.forEach((color, idx) => {
                const c = document.createElement("div");
                c.className = "color-option";
                c.style.background = color;
                c.textContent = idx; 
                c.style.color = '#fff'; 
                c.style.textShadow='0 0.1vw 0.2vw rgba(0,0,0,.6)'; 
                c.style.fontSize = '1.6vw'; 
                c.style.fontWeight = 'bold'; 
                c.style.display = 'grid'; 
                c.style.textAlign = 'center'; 
                c.style.alignItems = 'center'; 
                c.onclick = () => {
                    playSound('beep');
                    currentGuess[slotIndex] = idx;
                    hidePopup();
                    renderGame();
                };
                popup.appendChild(c);
            });
        }

        // hide submenu
        function hidePopup() {
            const popup = document.getElementById("colorPopup");
            popup.style.display = "none";
        }

        document.addEventListener("click", (e) => {
            const popup = document.getElementById("colorPopup");
            if (!popup.contains(e.target) && !e.target.classList.contains("slot")) {
                hidePopup();
            }
        });


        let selectedIndex = null;

        // check user guess
        function checkGuess() {
            if (gameOver) return;

            if (currentGuess.includes(null)) {
                alert("‚ùó Fill all slots first!");
                return;
            }

            if (!allowDuplicates) {
                const uniqueColors = new Set(currentGuess);
                if (uniqueColors.size < currentGuess.length) {
                    alert("No duplicate colors allowed!");
                    return;
                }
            }

            const guessCopy = [...currentGuess];
            const codeCopy = [...secretCode];

            let black = 0;
            let white = 0;

            for (let i = 0; i < slotCount; i++) {
                if (guessCopy[i] === codeCopy[i]) {
                    black++;
                    guessCopy[i] = codeCopy[i] = null;
                }
            }

            for (let i = 0; i < slotCount; i++) {
                if (guessCopy[i] !== null) {
                    const index = codeCopy.indexOf(guessCopy[i]);
                    if (index !== -1) {
                        white++;
                        codeCopy[index] = null;
                    }
                }
            }

            guesses.push({ guess: [...currentGuess], black, white });
            attemptsLeft--;
            currentGuess = Array(slotCount).fill(null);
            selectedIndex = null;

            if (black === slotCount) {
                gameOver = true;
                updateScoreboard("üéâ You cracked the code!");
                saveToLeaderboard(player1);
                timer = false;
                playSound('win');
                launchFireworks();
            } else if (attemptsLeft <= 0) {
                gameOver = true;
                updateScoreboard("üí• Out of attempts! Code was revealed.");
                timer = false;
                playSound('loose');
                textToSpeechEng(`Out of attempts`);
            } else {
                updateScoreboard(`Exect ${black == 0 ? "nil" : black} and Misplace ${white == 0 ? "nil" : white}`);
                textToSpeechEng(`Exect ${black == 0 ? "nil" : black} and Misplace ${white == 0 ? "nil" : white}`);
                if(attemptsLeft == 2) {
                    textToSpeechEng(`second Last attempt`);
                }
                if(attemptsLeft == 1) {
                    textToSpeechEng(`Last attempt`);
                }
                playSound('submit');
            }

            renderGame();
        }

        // theme toggle
        function toggleDarkMode() {
            document.body.classList.toggle("dark");
        }

        // undo
        function undoLastMove() {
            if (guesses.length === 0 || gameOver) return;
            const last = guesses.pop();
            attemptsLeft++;
            textToSpeechEng(`undo`);
            updateScoreboard();
            renderGame();
        }

        // end game by use if not played
        function endGameManually() {
            const secretRow = document.createElement("div");
            secretRow.className = "row";
            secretCode.forEach(colorIdx => {
                const slot = document.createElement("div");
                slot.className = "slot";
                slot.style.background = colors[colorIdx];
                secretRow.appendChild(slot);
            });
            visualEl.appendChild(secretRow);
            updateScoreboard("üí• End game! Code was revealed.");
            timer = false;
            playSound('loose');
            disableGame();
        }

        // disable submenu display
        function disableGame() {
            const slots = document.querySelectorAll(".slot");
            slots.forEach(slot => {
                slot.onclick = null;
            });
            document.getElementById("colorPopup").style.display = "none";
        }

        // display timer
        // import { timer } from './script.js';

        // let seconds = 0;
        // let minutes = 0;
        // let hours = 0;
        // let hrdsec = 0;

        // display upadted time of game play
        function displayTime() {
            document.getElementById('timer-display').textContent = '‚è±Ô∏è' + ((hours < 10) ? '0' + hours : hours) + ':' + ((minutes < 10) ? '0' + minutes : minutes) + ':' + ((seconds < 10) ? '0' + seconds : seconds);
        }

        // update of time para
        function updateTimer() {
                displayTime();
                setInterval(() => { 
                if (timer) {
                    hrdsec++
                    if (hrdsec >= 100) {
                        hrdsec = 0;
                        seconds++;
                        if (seconds >= 60) {
                            seconds = 0;
                            minutes++;
                            if (minutes >= 60) {
                                minutes = 0;
                                hours++;
                            }
                        }
                    }
                }
                displayTime();
                }, 10);
        }

        //these para to play sound
        function playSound(sound) {
            if (sound == 'beep') {
                var beep = new Audio('assets/sound/tap-sound.mp3');
            } else if (sound == 'win') {
                var beep = new Audio('assets/sound/winner-trumpets.mp3');
            } else if (sound == 'loose') {
                var beep = new Audio('assets/sound/Looser.mp3');
            } else if (sound == 'submit') {
                var beep = new Audio('assets/sound/inhalation-and-exhalation.mp3');
            }
            beep.play();
        }

        // Sound objects
        const sounds = {
            click: new Audio('assets/sound/tap-sound.mp3'),
            beep: new Audio('assets/sound/Clock-ticking-Turning-one.mp3'),
            submit: new Audio('assets/sound/inhalation-and-exhalation.mp3'),
            win: new Audio('assets/sound/winner-trumpets.mp3'),
            loose: new Audio('assets/sound/Looser.mp3'),
            bg: new Audio('assets/sound/bg-music.mp3'),
            fire: new Audio('assets/sound/fireworks.mp3')
        };

        let soundEnabled = false;

        document.getElementById("toggle-sound").addEventListener("click", () => {
            soundEnabled = !soundEnabled;
            document.getElementById("toggle-sound").textContent = soundEnabled ? "üîä Sound: On" : "üîá Sound: Off";
            if (soundEnabled) sounds.bg.play();
            else sounds.bg.pause();
        });

        // Play sound helper
        function playSound(type) {
            if (sounds[type]) {
                sounds[type].currentTime = 0;
                sounds[type].play();
            }
        }

        // background music during page load and play
        window.addEventListener("load", () => {
            if (soundEnabled) playSound('bg');
        });

        document.getElementById("toggle-leaderboard").addEventListener("click", () => {
            toggleLeaderboard();
        });
        // const leaderboardEl = document.getElementById('leaderboard');
        // import { sec, min, hrs } from './timer.js';
        // import { modeEl, difficultyEl } from './script.js';

        // save score to leaderboard
        function saveToLeaderboard() {
            let round = maxAttempts - attemptsLeft;
            let elapsed = `${hours}:${minutes}:${seconds}`;
            const time = new Date().toLocaleString();
            const entry = { player1, slotCount, colorCount, allowDuplicates, round, time, elapsed };
            const boardData = JSON.parse(localStorage.getItem("leaderboard") || "[]");
            boardData.push(entry);
            localStorage.setItem("leaderboard", JSON.stringify(boardData));
        }

        // toggle leaderboard
        function toggleLeaderboard() {
            if (leaderboardEl.style.display === 'block') {
                document.getElementById("toggle-leaderboard").textContent = "View Leaderboard";
                leaderboardEl.style.display = 'none';
                return;
            }
            const data = JSON.parse(localStorage.getItem('leaderboard') || '[]');
            document.getElementById("toggle-leaderboard").textContent = "Hide Leaderboard";
            if (data.length === 0) {
                leaderboardEl.innerHTML = '<h3>üèÜ Leaderboard</h3><p>No entries yet.</p>';
            } else {
                leaderboardEl.innerHTML = `<h3 style="display: inline-block; margin-right: 1vw;">üèÜ Leaderboard</h3><button id="clearleaderboard" onclick="clearLeaderboard()">Clear Leaderboard</button><table><thead><tr><th>Winner</th><th>Slots</th><th>Colors</th><th>Duplicate Colors</th><th>Attempts</th><th>Time</th><th>Elapsed</th></tr></thead><tbody>${data.map(entry => `<tr><td>${entry.player1}</td><td>${entry.slotCount}</td><td>${entry.colorCount}</td><td>${entry.allowDuplicates}</td><td>${entry.round}</td><td>${entry.time}</td><td>${entry.elapsed}</td></tr>`).join('')}</tbody></table>`;
            }
            leaderboardEl.style.display = 'block';
        }

        // clear leaderboard data
        // document.getElementById("clearleaderboard").addEventListener("click", () => {
        function clearLeaderboard() {
            if (confirm("Do you realy Want to Remove Leaderboard data?")) {
                localStorage.removeItem('leaderboard');
                alert("Leaderboard Data is Cleared");
            }
        }

        //toggle theme
        document.getElementById("dark").addEventListener("click", () => {
            document.body.classList.toggle("dark");
            if (document.body.classList.contains("dark")) {
                document.getElementById("dark").innerText = "‚òÄÔ∏è Light";
                textToSpeechEng('Theme Dark');
            } else {
                document.getElementById("dark").innerText = "üåô Dark";
                textToSpeechEng('Theme Light');
            }
        });

        //   import { winnerName } from './script.js';
        class FireParticle {
            constructor(x, y, color, dx, dy, shape) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.dx = dx;
                this.dy = dy;
                this.shape = shape;
                this.alpha = 1;
                this.gravity = 0.08;
                this.size = 4 + Math.random() * 4;
            }

            drawPolygon(ctx, sides) {
                const step = (Math.PI * 2) / sides;
                ctx.moveTo(this.size, 0);
                for (let i = 1; i <= sides; i++) {
                    ctx.lineTo(this.size * Math.cos(i * step), this.size * Math.sin(i * step));
                }
            }

            drawStar(ctx, points, innerRatio = 0.5) {
                const step = Math.PI / points;
                ctx.moveTo(this.size, 0);
                for (let i = 0; i < 2 * points; i++) {
                    const radius = i % 2 === 0 ? this.size : this.size * innerRatio;
                    const angle = i * step;
                    ctx.lineTo(radius * Math.cos(angle), radius * Math.sin(angle));
                }
                ctx.closePath();
            }

            // drawStar1(ctx, x, y, outerRadius, innerRadius, points, rotation = 0) {
            drawStar1(ctx, x, y, points, rotation = 0) {
                ctx.beginPath();
                for (let i = 0; i < points * 2; i++) {
                    const radius = i % 2 === 0 ? this.size : this.size * 0.5;
                    const angle = rotation + (i * Math.PI / points);
                    const currentX = x + radius * Math.cos(angle);
                    const currentY = y + radius * Math.sin(angle);
                    if (i === 0) {
                        ctx.moveTo(currentX, currentY);
                    } else {
                        ctx.lineTo(currentX, currentY);
                    }
                }
                ctx.closePath();
                ctx.stroke(); // or ctx.fill()
            }

            update(ctx) {
                this.dy += this.gravity;
                this.x += this.dx;
                this.y += this.dy;
                this.alpha -= 0.02;

                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                // for neon display
                ctx.shadowBlur = 20;
                ctx.shadowColor = this.color;
                ctx.strokeStyle = this.color;
                ctx.translate(this.x, this.y);
                ctx.beginPath();
                switch (this.shape) {
                    case 'freehandOpen':
                        ctx.moveTo(-this.size, -this.size / 2);
                        for (let i = 0; i < 4; i++) {
                            const dx = (Math.random() - 0.5) * this.size;
                            const dy = (Math.random() - 0.5) * this.size;
                            ctx.lineTo(dx, dy);
                        }
                        break;
                    case 'freehandClosed':
                        ctx.moveTo(-this.size, -this.size / 2);
                        for (let i = 0; i < 4; i++) {
                            const dx = (Math.random() - 0.5) * this.size;
                            const dy = (Math.random() - 0.5) * this.size;
                            ctx.lineTo(dx, dy);
                        }
                        ctx.closePath();
                        break;
                    case 'circle': ctx.arc(0, 0, this.size, 0, 2 * Math.PI); break;
                    case 'square': ctx.rect(-this.size / 2, -this.size / 2, this.size, this.size); break;
                    case 'triangle':
                        ctx.moveTo(0, -this.size);
                        ctx.lineTo(this.size, this.size);
                        ctx.lineTo(-this.size, this.size);
                        ctx.closePath(); break;
                    case 'ellipse':
                        ctx.ellipse(0, 0, this.size, this.size * 0.6, 0, 0, Math.PI * 2); break;
                    case 'zigzag':
                        for (let i = 0; i < 5; i++) {
                            const x = i * this.size / 5 - this.size / 2;
                            const y = (i % 2 === 0 ? -1 : 1) * this.size / 2;
                            ctx.lineTo(x, y);
                        } break;
                    case 'pentagon': this.drawPolygon(ctx, 5); break;
                    case 'hexagon': this.drawPolygon(ctx, 6); break;
                    case 'heptagon': this.drawPolygon(ctx, 7); break;
                    case 'octagon': this.drawPolygon(ctx, 8); break;
                    case 'nonagon': this.drawPolygon(ctx, 9); break;
                    case 'decagon': this.drawPolygon(ctx, 10); break;
                    case 'star5': this.drawStar(ctx, 5); break;
                    case 'star6': this.drawStar(ctx, 6); break;
                    case 'star7': this.drawStar(ctx, 7); break;
                    case 'star8': this.drawStar(ctx, 8); break;
                    case 'star9': this.drawStar(ctx, 9); break;
                    case 'star10': this.drawStar(ctx, 10); break;
                    case 'star15': this.drawStar1(ctx, 5); break;
                    case 'star16': this.drawStar1(ctx, 6); break;
                    case 'star17': this.drawStar1(ctx, 7); break;
                    case 'star18': this.drawStar1(ctx, 8); break;
                    case 'star19': this.drawStar1(ctx, 9); break;
                    case 'star20': this.drawStar1(ctx, 10); break;
                    default: ctx.arc(0, 0, this.size, 0, 2 * Math.PI);
                }
                ctx.fill();
                ctx.restore();
            }

            isAlive() {
                return this.alpha > 0;
            }
        }

        class GroundCracker {
            constructor(x, y) {
                this.particles = [];
                this.colors = ['#ff0000', '#ffff00', '#00ff00', '#00ffff', '#ff00ff', '#ffffff'];
                this.shapes = [
                    'freehandOpen', 'freehandClosed',
                    'circle', 'square', 'triangle', 'ellipse', 'zigzag',
                    'pentagon', 'hexagon', 'heptagon', 'octagon', 'nonagon', 'decagon',
                    'pentagon', 'hexagon', 'heptagon', 'octagon', 'nonagon', 'decagon',
                    'star5', 'star6', 'star7', 'star8', 'star9', 'star10',
                    'star15', 'star16', 'star17', 'star18', 'star19', 'star20',
                    'freehandOpen', 'freehandClosed'
                ]; for (let i = 0; i < 60; i++) {
                    const angle = Math.random() * 2 * Math.PI;
                    const speed = Math.random() * 4 + 1.5;
                    const dx = Math.cos(angle) * speed;
                    const dy = Math.sin(angle) * speed;
                    const color = this.colors[Math.floor(Math.random() * this.colors.length)];
                    const shape = this.shapes[Math.floor(Math.random() * this.shapes.length)];
                    this.particles.push(new FireParticle(x, y, color, dx, dy, shape));
                }
            }

            update(ctx) {
                this.particles.forEach(p => p.update(ctx));
                this.particles = this.particles.filter(p => p.isAlive());
            }

            isAlive() {
                return this.particles.length > 0;
            }
        }

        // show wining text using canvas
        function drawNeonText(ctx, canvas) {
            ctx.save();
            ctx.font = "bold 4vw EnglishFontBangers";
            if (document.body.classList.contains("dark")) {
                ctx.fillStyle = 'rgba(255,255,255,0.15)';
            } else {
                ctx.fillStyle = 'rgba(0,0,0,0.15)';
            }
            ctx.textAlign = "center";
            ctx.letterSpacing = "0.5vw";

            ctx.textBaseline = "middle";
            ctx.shadowColor = "lightblue";
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            ctx.shadowBlur = 5;
            if (document.body.classList.contains("dark")) {
                ctx.shadowColor = 'rgb(128, 0, 128)';
                ctx.fillText(`üéâ ${player1} Won! üéâ`, canvas.width / 2, canvas.height / 2);
            } else {
                ctx.shadowColor = 'rgb(0, 255, 255)';
                ctx.fillText(`üéâ ${player1} Won! üéâ`, canvas.width / 2, canvas.height / 2);
            }
            ctx.restore();
        }

        // launch fireworks 
        function launchFireworks() {
            const canvas = document.createElement('canvas');
            canvas.style.position = 'fixed';
            canvas.style.top = 0;
            canvas.style.left = 0;
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            canvas.style.zIndex = 9999;
            canvas.style.pointerEvents = 'none';
            document.body.appendChild(canvas);

            const ctx = canvas.getContext('2d');
            const crackers = [];

            // Edges only - top, bottom, left, right (not center)
            const edgeCrackers = 8;
            const padding = 60;

            for (let i = 0; i < edgeCrackers; i++) {
                // Top
                crackers.push(new GroundCracker(
                    padding + i * (window.innerWidth - 2 * padding) / (edgeCrackers - 1),
                    padding
                ));
                // Bottom
                crackers.push(new GroundCracker(
                    padding + i * (window.innerWidth - 2 * padding) / (edgeCrackers - 1),
                    window.innerHeight - padding
                ));
                // Left
                crackers.push(new GroundCracker(
                    padding,
                    padding + i * (window.innerHeight - 2 * padding) / (edgeCrackers - 1)
                ));
                // Right
                crackers.push(new GroundCracker(
                    window.innerWidth - padding,
                    padding + i * (window.innerHeight - 2 * padding) / (edgeCrackers - 1)
                ));
            }

            function animate() {
                if (document.body.classList.contains("dark")) {
                    ctx.fillStyle = 'rgba(0,0,0,0.01)';
                } else {
                    ctx.fillStyle = 'rgba(255,255,255,0.01)';
                }

                ctx.fillRect(0, 0, canvas.width, canvas.height);
                // show wining text using canvas
                drawNeonText(ctx, canvas);
                crackers.forEach(c => c.update(ctx));
                for (let i = crackers.length - 1; i >= 0; i--) {
                    if (!crackers[i].isAlive()) crackers.splice(i, 1);
                }

                if (crackers.length > 0) {
                    requestAnimationFrame(animate);
                } else {
                    document.body.removeChild(canvas);
                }
            }

            animate();
        }

        // para to speeach in english
        // export function textToSpeechEng(text) {
        function textToSpeechEng(text) {
            let speechSynthesis = window.speechSynthesis;
            let utterance = new SpeechSynthesisUtterance();
            utterance.lang = "en-US";
            utterance.voice = speechSynthesis.getVoices().find(voice => voice.lang === 'en-US');
            utterance.text = text;
            speechSynthesis.speak(utterance);
        }
    </script>
</body>

</html>